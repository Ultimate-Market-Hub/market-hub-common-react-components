import{r as u,R as I}from"./index-c013ead5.js";import{S as J,D as z,y as W,T as me,f as re,s as ie,o as E,u as H,X as A,I as K,l as Pe,O as G,M as N,h as be,a as Se,b as L,e as ye,N as ee}from"./use-is-mounted-b8dc6585.js";import{n as oe,h as Ee,c as ge,d as q,C as pe,r as ce}from"./use-owner-3c26545a.js";import{s as $e}from"./use-resolve-button-type-f97b0eac.js";import{a as Ie,j as he,E as Te,n as de,y as xe,s as _}from"./dialog-dfdaf664.js";import{c as te,p as ne}from"./hidden-e72868fd.js";var Ce=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ce||{}),we=(e=>(e[e.TogglePopover=0]="TogglePopover",e[e.ClosePopover=1]="ClosePopover",e[e.SetButton=2]="SetButton",e[e.SetButtonId=3]="SetButtonId",e[e.SetPanel=4]="SetPanel",e[e.SetPanelId=5]="SetPanelId",e))(we||{});let Me={0:e=>{let o={...e,popoverState:H(e.popoverState,{0:1,1:0})};return o.popoverState===0&&(o.__demoMode=!1),o},1(e){return e.popoverState===1?e:{...e,popoverState:1}},2(e,o){return e.button===o.button?e:{...e,button:o.button}},3(e,o){return e.buttonId===o.buttonId?e:{...e,buttonId:o.buttonId}},4(e,o){return e.panel===o.panel?e:{...e,panel:o.panel}},5(e,o){return e.panelId===o.panelId?e:{...e,panelId:o.panelId}}},le=u.createContext(null);le.displayName="PopoverContext";function Q(e){let o=u.useContext(le);if(o===null){let v=new Error(`<${e} /> is missing a parent <Popover /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(v,Q),v}return o}let ue=u.createContext(null);ue.displayName="PopoverAPIContext";function ae(e){let o=u.useContext(ue);if(o===null){let v=new Error(`<${e} /> is missing a parent <Popover /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(v,ae),v}return o}let se=u.createContext(null);se.displayName="PopoverGroupContext";function fe(){return u.useContext(se)}let Z=u.createContext(null);Z.displayName="PopoverPanelContext";function Oe(){return u.useContext(Z)}function ke(e,o){return H(o.type,Me,e,o)}let Fe="div";function Re(e,o){var v;let{__demoMode:g=!1,...T}=e,l=u.useRef(null),t=W(o,me(s=>{l.current=s})),m=u.useRef([]),P=u.useReducer(ke,{__demoMode:g,popoverState:g?0:1,buttons:m,button:null,buttonId:null,panel:null,panelId:null,beforePanelSentinel:u.createRef(),afterPanelSentinel:u.createRef()}),[{popoverState:y,button:p,buttonId:$,panel:r,panelId:R,beforePanelSentinel:C,afterPanelSentinel:S},a]=P,b=oe((v=l.current)!=null?v:p),x=u.useMemo(()=>{if(!p||!r)return!1;for(let Y of document.querySelectorAll("body > *"))if(Number(Y==null?void 0:Y.contains(p))^Number(Y==null?void 0:Y.contains(r)))return!0;let s=re(),w=s.indexOf(p),V=(w+s.length-1)%s.length,j=(w+1)%s.length,X=s[V],ve=s[j];return!r.contains(X)&&!r.contains(ve)},[p,r]),M=ie($),O=ie(R),B=u.useMemo(()=>({buttonId:M,panelId:O,close:()=>a({type:1})}),[M,O,a]),k=fe(),i=k==null?void 0:k.registerPopover,h=E(()=>{var s;return(s=k==null?void 0:k.isFocusWithinPopoverGroup())!=null?s:(b==null?void 0:b.activeElement)&&((p==null?void 0:p.contains(b.activeElement))||(r==null?void 0:r.contains(b.activeElement)))});u.useEffect(()=>i==null?void 0:i(B),[i,B]);let[c,F]=Ie(),n=he({mainTreeNodeRef:k==null?void 0:k.mainTreeNodeRef,portals:c,defaultContainers:[p,r]});Te(b==null?void 0:b.defaultView,"focus",s=>{var w,V,j,X;s.target!==window&&s.target instanceof HTMLElement&&y===0&&(h()||p&&r&&(n.contains(s.target)||(V=(w=C.current)==null?void 0:w.contains)!=null&&V.call(w,s.target)||(X=(j=S.current)==null?void 0:j.contains)!=null&&X.call(j,s.target)||a({type:1})))},!0),Ee(n.resolveContainers,(s,w)=>{a({type:1}),be(w,Se.Loose)||(s.preventDefault(),p==null||p.focus())},y===0);let d=E(s=>{a({type:1});let w=(()=>s?s instanceof HTMLElement?s:"current"in s&&s.current instanceof HTMLElement?s.current:p:p)();w==null||w.focus()}),f=u.useMemo(()=>({close:d,isPortalled:x}),[d,x]),D=u.useMemo(()=>({open:y===0,close:d}),[y,d]),U={ref:t};return I.createElement(Z.Provider,{value:null},I.createElement(le.Provider,{value:P},I.createElement(ue.Provider,{value:f},I.createElement(ge,{value:H(y,{0:q.Open,1:q.Closed})},I.createElement(F,null,A({ourProps:U,theirProps:T,slot:D,defaultTag:Fe,name:"Popover"}),I.createElement(n.MainTreeNode,null))))))}let Be="button";function De(e,o){let v=K(),{id:g=`headlessui-popover-button-${v}`,...T}=e,[l,t]=Q("Popover.Button"),{isPortalled:m}=ae("Popover.Button"),P=u.useRef(null),y=`headlessui-focus-sentinel-${K()}`,p=fe(),$=p==null?void 0:p.closeOthers,r=Oe()!==null;u.useEffect(()=>{if(!r)return t({type:3,buttonId:g}),()=>{t({type:3,buttonId:null})}},[r,g,t]);let[R]=u.useState(()=>Symbol()),C=W(P,o,r?null:n=>{if(n)l.buttons.current.push(R);else{let d=l.buttons.current.indexOf(R);d!==-1&&l.buttons.current.splice(d,1)}l.buttons.current.length>1&&console.warn("You are already using a <Popover.Button /> but only 1 <Popover.Button /> is supported."),n&&t({type:2,button:n})}),S=W(P,o),a=oe(P),b=E(n=>{var d,f,D;if(r){if(l.popoverState===1)return;switch(n.key){case L.Space:case L.Enter:n.preventDefault(),(f=(d=n.target).click)==null||f.call(d),t({type:1}),(D=l.button)==null||D.focus();break}}else switch(n.key){case L.Space:case L.Enter:n.preventDefault(),n.stopPropagation(),l.popoverState===1&&($==null||$(l.buttonId)),t({type:0});break;case L.Escape:if(l.popoverState!==0)return $==null?void 0:$(l.buttonId);if(!P.current||a!=null&&a.activeElement&&!P.current.contains(a.activeElement))return;n.preventDefault(),n.stopPropagation(),t({type:1});break}}),x=E(n=>{r||n.key===L.Space&&n.preventDefault()}),M=E(n=>{var d,f;ce(n.currentTarget)||e.disabled||(r?(t({type:1}),(d=l.button)==null||d.focus()):(n.preventDefault(),n.stopPropagation(),l.popoverState===1&&($==null||$(l.buttonId)),t({type:0}),(f=l.button)==null||f.focus()))}),O=E(n=>{n.preventDefault(),n.stopPropagation()}),B=l.popoverState===0,k=u.useMemo(()=>({open:B}),[B]),i=$e(e,P),h=r?{ref:S,type:i,onKeyDown:b,onClick:M}:{ref:C,id:l.buttonId,type:i,"aria-expanded":l.popoverState===0,"aria-controls":l.panel?l.panelId:void 0,onKeyDown:b,onKeyUp:x,onClick:M,onMouseDown:O},c=de(),F=E(()=>{let n=l.panel;if(!n)return;function d(){H(c.current,{[_.Forwards]:()=>G(n,N.First),[_.Backwards]:()=>G(n,N.Last)})===ee.Error&&G(re().filter(f=>f.dataset.headlessuiFocusGuard!=="true"),H(c.current,{[_.Forwards]:N.Next,[_.Backwards]:N.Previous}),{relativeTo:l.button})}d()});return I.createElement(I.Fragment,null,A({ourProps:h,theirProps:T,slot:k,defaultTag:Be,name:"Popover.Button"}),B&&!r&&m&&I.createElement(te,{id:y,features:ne.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:F}))}let Ne="div",_e=J.RenderStrategy|J.Static;function Le(e,o){let v=K(),{id:g=`headlessui-popover-overlay-${v}`,...T}=e,[{popoverState:l},t]=Q("Popover.Overlay"),m=W(o),P=pe(),y=(()=>P!==null?(P&q.Open)===q.Open:l===0)(),p=E(r=>{if(ce(r.currentTarget))return r.preventDefault();t({type:1})}),$=u.useMemo(()=>({open:l===0}),[l]);return A({ourProps:{ref:m,id:g,"aria-hidden":!0,onClick:p},theirProps:T,slot:$,defaultTag:Ne,features:_e,visible:y,name:"Popover.Overlay"})}let Ge="div",He=J.RenderStrategy|J.Static;function Ke(e,o){let v=K(),{id:g=`headlessui-popover-panel-${v}`,focus:T=!1,...l}=e,[t,m]=Q("Popover.Panel"),{close:P,isPortalled:y}=ae("Popover.Panel"),p=`headlessui-focus-sentinel-before-${K()}`,$=`headlessui-focus-sentinel-after-${K()}`,r=u.useRef(null),R=W(r,o,i=>{m({type:4,panel:i})}),C=oe(r);Pe(()=>(m({type:5,panelId:g}),()=>{m({type:5,panelId:null})}),[g,m]);let S=pe(),a=(()=>S!==null?(S&q.Open)===q.Open:t.popoverState===0)(),b=E(i=>{var h;switch(i.key){case L.Escape:if(t.popoverState!==0||!r.current||C!=null&&C.activeElement&&!r.current.contains(C.activeElement))return;i.preventDefault(),i.stopPropagation(),m({type:1}),(h=t.button)==null||h.focus();break}});u.useEffect(()=>{var i;e.static||t.popoverState===1&&((i=e.unmount)==null||i)&&m({type:4,panel:null})},[t.popoverState,e.unmount,e.static,m]),u.useEffect(()=>{if(t.__demoMode||!T||t.popoverState!==0||!r.current)return;let i=C==null?void 0:C.activeElement;r.current.contains(i)||G(r.current,N.First)},[t.__demoMode,T,r,t.popoverState]);let x=u.useMemo(()=>({open:t.popoverState===0,close:P}),[t,P]),M={ref:R,id:g,onKeyDown:b,onBlur:T&&t.popoverState===0?i=>{var h,c,F,n,d;let f=i.relatedTarget;f&&r.current&&((h=r.current)!=null&&h.contains(f)||(m({type:1}),((F=(c=t.beforePanelSentinel.current)==null?void 0:c.contains)!=null&&F.call(c,f)||(d=(n=t.afterPanelSentinel.current)==null?void 0:n.contains)!=null&&d.call(n,f))&&f.focus({preventScroll:!0})))}:void 0,tabIndex:-1},O=de(),B=E(()=>{let i=r.current;if(!i)return;function h(){H(O.current,{[_.Forwards]:()=>{var c;G(i,N.First)===ee.Error&&((c=t.afterPanelSentinel.current)==null||c.focus())},[_.Backwards]:()=>{var c;(c=t.button)==null||c.focus({preventScroll:!0})}})}h()}),k=E(()=>{let i=r.current;if(!i)return;function h(){H(O.current,{[_.Forwards]:()=>{var c;if(!t.button)return;let F=re(),n=F.indexOf(t.button),d=F.slice(0,n+1),f=[...F.slice(n+1),...d];for(let D of f.slice())if(D.dataset.headlessuiFocusGuard==="true"||(c=t.panel)!=null&&c.contains(D)){let U=f.indexOf(D);U!==-1&&f.splice(U,1)}G(f,N.First,{sorted:!1})},[_.Backwards]:()=>{var c;G(i,N.Previous)===ee.Error&&((c=t.button)==null||c.focus())}})}h()});return I.createElement(Z.Provider,{value:g},a&&y&&I.createElement(te,{id:p,ref:t.beforePanelSentinel,features:ne.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:B}),A({ourProps:M,theirProps:l,slot:x,defaultTag:Ge,features:He,visible:a,name:"Popover.Panel"}),a&&y&&I.createElement(te,{id:$,ref:t.afterPanelSentinel,features:ne.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:k}))}let We="div";function qe(e,o){let v=u.useRef(null),g=W(v,o),[T,l]=u.useState([]),t=xe(),m=E(S=>{l(a=>{let b=a.indexOf(S);if(b!==-1){let x=a.slice();return x.splice(b,1),x}return a})}),P=E(S=>(l(a=>[...a,S]),()=>m(S))),y=E(()=>{var S;let a=ye(v);if(!a)return!1;let b=a.activeElement;return(S=v.current)!=null&&S.contains(b)?!0:T.some(x=>{var M,O;return((M=a.getElementById(x.buttonId.current))==null?void 0:M.contains(b))||((O=a.getElementById(x.panelId.current))==null?void 0:O.contains(b))})}),p=E(S=>{for(let a of T)a.buttonId.current!==S&&a.close()}),$=u.useMemo(()=>({registerPopover:P,unregisterPopover:m,isFocusWithinPopoverGroup:y,closeOthers:p,mainTreeNodeRef:t.mainTreeNodeRef}),[P,m,y,p,t.mainTreeNodeRef]),r=u.useMemo(()=>({}),[]),R=e,C={ref:g};return I.createElement(se.Provider,{value:$},A({ourProps:C,theirProps:R,slot:r,defaultTag:We,name:"Popover.Group"}),I.createElement(t.MainTreeNode,null))}let je=z(Re),ze=z(De),Ae=z(Le),Ue=z(Ke),Ve=z(qe),tt=Object.assign(je,{Button:ze,Overlay:Ae,Panel:Ue,Group:Ve});export{tt as k};
